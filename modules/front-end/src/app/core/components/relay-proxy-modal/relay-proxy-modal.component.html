<nz-modal
  nzClassName="relay-proxy-modal"
  [(nzVisible)]="visible"
  [nzTitle]="title"
  [nzCentered]="true"
  [nzContent]="modalContent"
  [nzFooter]="modalFooter"
  [nzWidth]="550"
  (nzOnCancel)="close(null)">
  <ng-template #modalContent>
    <form nz-form [formGroup]="form" nzLayout="vertical">
      <!-- Name  -->
      <nz-form-item>
        <nz-form-label nzRequired i18n="@@common.name">Name</nz-form-label>
        <nz-form-control
          nzHasFeedback
          nzValidatingTip="Validating..."
          i18n-nzValidatingTip="@@common.validating"
          [nzErrorTip]="segmentNameErrorTpl">
          <input nz-input formControlName="name"/>
          <ng-template #segmentNameErrorTpl let-control>
            <ng-container *ngIf="control.hasError('required')" i18n="@@common.name-cannot-be-empty">Name cannot be empty</ng-container>
            <ng-container *ngIf="control.hasError('duplicated')" i18n="@@common.name-has-been-used">This name has been used</ng-container>
            <ng-container *ngIf="control.hasError('unknown')" i18n="@@common.name-validation-failed">Name validation failed</ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>

      <!-- Description  -->
      <nz-form-item>
        <nz-form-label i18n="@@common.description">Description</nz-form-label>
        <nz-form-control>
          <textarea
            style="resize: none"
            nz-input
            formControlName="description"
            placeholder="Description"
            i18n-placeholder="@@common.description"
          ></textarea>
        </nz-form-control>
      </nz-form-item>

      <!-- Scopes  -->
      <nz-form-item>
        <nz-form-label nzRequired i18n="@@common.scopes">Scopes</nz-form-label>
        <nz-form-control
          nzErrorTip="Please select at least one environment."
          i18n-nzErrorTip="@@relay-proxy.modal.scopes-cannot-be-empty"
          nzExtra="Select the environments that the agent can serve."
          i18n-nzExtra="@@relay-proxy.modal.scopes-description">
          <resource-finder
            [isVisible]="resourceFinderVisible"
            (onClose)="closeResourceFinder($event)"
            [resources]="[ResourceTypeEnum.Env]"
            [spaceLevel]="ResourceSpaceLevel.Organization"
            [defaultSelected]="selectedScopes">
          </resource-finder>
          <ng-container formArrayName="scopes">
            <div *ngFor="let control of scopes.controls; index as i">
              <nz-tag nzMode="closeable" (nzOnClose)="removeScope(i)">
                {{ control.value }}
              </nz-tag>
            </div>
          </ng-container>
          <button type="button" class="add-scope-button" nz-button nzType="link" (click)="openResourceFinder()">
            <i nz-icon nzType="icons:icon-choose" nzTheme="outline"></i>
            <span i18n="@@common.choose-scopes">Choose Scopes</span>
          </button>
        </nz-form-control>
      </nz-form-item>

      <!-- Agents -->
    </form>
  </ng-template>

  <ng-template #modalFooter>
    <div class="actions">
      <button nz-button nzType="default" (click)="close(null)" i18n="@@common.cancel">Cancel</button>
      <button
        nz-button
        nzType="primary"
        [nzLoading]="this.saving"
        (click)="save()"
        i18n="@@common.save">Save</button>
    </div>
  </ng-template>
</nz-modal>
