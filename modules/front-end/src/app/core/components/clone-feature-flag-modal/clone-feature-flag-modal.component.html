<nz-modal
  nzClassName="clone-flag-modal"
  [nzVisible]="visible"
  [nzCentered]="true"
  nzTitle="Clone feature flag"
  i18n-nzTitle="@@ff.clone-flag.title"
  [nzWidth]="620"
  [nzContent]="content"
  [nzFooter]="footer"
  (nzOnCancel)="onClose()">
  <ng-template #content>
    <nz-alert nzType="success" [nzDescription]="description" nzShowIcon>
      <ng-template #description>
        <span i18n="@ff.clone.description">Cloning a flag copies the full targeting configuration from the source flag to the new flag.</span>
      </ng-template>
    </nz-alert>

    <div class="flag-to-clone">
      <span class="label" i18n="@@ff.clone.flag-to-clone">Flag to clone:</span>
      <a [routerLink]="[flag?.key, 'targeting']" target="_blank">{{flag?.name}}</a>
    </div>

    <form nz-form [formGroup]="form" nzLayout="vertical">
      <div class="name-key-wrapper">
        <!--  Name  -->
        <nz-form-item>
          <nz-form-label nzRequired i18n="@@common.name">Name</nz-form-label>
          <nz-form-control
            nzHasFeedback
            nzErrorTip="Name cannot be empty"
            i18n-nzErrorTip="@@common.name-cannot-be-empty">
            <input
              nz-input
              formControlName="name"
              placeholder="A human-friendly name"
              i18n-placeholder="@@ff.feature-flag-name-placeholder"
            />
          </nz-form-control>
        </nz-form-item>

        <!--  Key  -->
        <nz-form-item>
          <nz-form-label
            nzRequired
            nzTooltipTitle="Use key (case-sensitive) in your code to get the feature flag variation. Keys must only contain letters, numbers, ., _ or -."
            i18n-nzTooltipTitle="@@ff.key-creation-description">
            Key
          </nz-form-label>
          <nz-form-control
            nzHasFeedback
            nzValidatingTip="Validating..."
            i18n-nzValidatingTip="@@common.validating"
            [nzErrorTip]="keyErrorTpl">
            <input
              nz-input
              formControlName="key"
              placeholder="Key can be auto-generated from name"
              i18n-placeholder="@@common.key-generated-from-name"/>
            <ng-template #keyErrorTpl let-control>
              @if (control.hasError('required')) {
                <ng-container i18n="@@common.key-cannot-be-empty">Key cannot be empty</ng-container>
              }
              @if (control.hasError('pattern')) {
                <ng-container i18n="@@common.key-format-error">Only allow letters, numbers, '.', '_' or '-'
                </ng-container>
              }
              @if (control.hasError('duplicated')) {
                <ng-container i18n="@@common.key-has-been-used">This key has been used</ng-container>
              }
              @if (control.hasError('unknown')) {
                <ng-container i18n="@@common.key-validation-failed">Key validation failed</ng-container>
              }
            </ng-template>
          </nz-form-control>
        </nz-form-item>
      </div>

      <!--  Description  -->
      <nz-form-item>
        <nz-form-label i18n="@@common.description">Description</nz-form-label>
        <nz-form-control
          nzHasFeedback
          nzErrorTip="Cannot exceed 512 characters"
          i18n-nzErrorTip="@@common.description.cannot-exceed-512-characters">
          <textarea
            nz-input
            formControlName="description"
            placeholder="Description"
            i18n-placeholder="@@common.description">
          </textarea>
        </nz-form-control>
      </nz-form-item>

      <!--  Tags  -->
      <nz-form-item>
        <nz-form-label i18n="@@common.tags">Tags</nz-form-label>
        <nz-form-control>
          <nz-select
            class="nz-select-36"
            nzMode="tags"
            nzPlaceHolder="Select Tags"
            nzAllowClear
            nzShowSearch
            [nzMaxTagCount]="3"
            [nzMaxTagPlaceholder]="omittedPlaceHolder"
            formControlName="tags">
            @if (isLoadingTags) {
              <nz-option nzDisabled nzCustomContent>
                <i nz-icon nzType="loading" class="loading-icon"></i>
                <ng-container i18n="@@common.loading">Loading...</ng-container>
              </nz-option>
            } @else {
              @for (tag of this.allTags; track tag) {
                <nz-option [nzValue]="tag" [nzLabel]="tag"></nz-option>
              }
            }
          </nz-select>
          <ng-template #omittedPlaceHolder let-omittedValues>and {{ omittedValues.length }} more...</ng-template>
        </nz-form-control>
      </nz-form-item>
    </form>

  </ng-template>

  <ng-template #footer>
    <div class="actions">
      <button nz-button nzType="default" (click)="onClose()" i18n="@@common.cancel">Cancel</button>
      <button
        nz-button
        nzType="primary"
        [disabled]="!form.valid"
        [nzLoading]="isCloning"
        (click)="doClone()"
        i18n="@@common.clone">Clone</button>
    </div>
  </ng-template>
</nz-modal>
