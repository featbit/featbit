<nz-drawer
  nzClosable="false"
  [nzExtra]="extra"
  [nzVisible]="visible"
  nzPlacement="right"
  i18n-nzTitle="@@expt.overview.expt"
  nzTitle="Experiment"
  [nzWidth]="500"
  (nzOnClose)="onClose()">
  <ng-container *nzDrawerContent>
    <form nz-form [formGroup]="experimentForm" (ngSubmit)="doSubmit()" nzLayout="vertical">
      <nz-form-item>
        <nz-form-label i18n="@@common.ff">Feature flag</nz-form-label>
        <nz-form-control i18n-nzErrorTip="@@common.ff" nzErrorTip="Feature flag">
          <nz-select
            class="nz-select-40"
            i18n-nzPlaceHolder="@@expt.overview.select-ff"
            nzPlaceHolder="Select feature flag"
            nzShowSearch
            nzServerSearch
            [compareWith]="compareWith"
            formControlName="featureFlag"
            (nzOnSearch)="onSearchFeatureFlag($event)"
            [nzOptionHeightPx]="36"
            [nzCustomTemplate]="ffTemplate"
            >
            @for (ff of featureFlagList?.items; track ff) {
              @if (!isFeatureFlagsLoading) {
                <nz-option nzCustomContent [nzValue]="ff" [nzLabel]="ff.name">
                  <span>{{ff.name}}</span>
                  @if (ff.isEnabled) {
                    <nz-tag class="status on">ON</nz-tag>
                  }
                  @if (!ff.isEnabled) {
                    <nz-tag class="status off">OFF</nz-tag>
                  }
                </nz-option>
              }
            }
            @if (isFeatureFlagsLoading) {
              <nz-option nzDisabled nzCustomContent>
                <i nz-icon nzType="loading" class="loading-icon"></i>
                <ng-container i18n="@@common.loading">Loading...</ng-container>
              </nz-option>
            }
          </nz-select>
          <ng-template #ffTemplate let-selected>
            <div class="selected-items-wrapper" style="">
              <span>{{selected.nzValue.name}}</span>
              @if (selected.nzValue.isEnabled) {
                <nz-tag class="status on">ON</nz-tag>
              }
              @if (!selected.nzValue.isEnabled) {
                <nz-tag class="status off">OFF</nz-tag>
              }
            </div>
          </ng-template>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label>Metric</nz-form-label>
        <nz-form-control nzErrorTip="Metric!">
          <nz-select
            class="nz-select-40"
            nzPlaceHolder="Metric"
            nzShowSearch
            nzServerSearch
            formControlName="metricId"
            (nzOnSearch)="onSearchMetrics($event)"
            >
            @for (o of pagedMetric?.items; track o) {
              @if (!isMetricsLoading) {
                <nz-option [nzValue]="o.id" [nzLabel]="o.name">
                </nz-option>
              }
            }
            @if (isMetricsLoading) {
              <nz-option nzDisabled nzCustomContent>
                <i nz-icon nzType="loading" class="loading-icon"></i>
                <ng-container i18n="@@common.loading">Loading...</ng-container>
              </nz-option>
            }
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label i18n="@@common.baseline-variation">Baseline</nz-form-label>
        <nz-form-control i18n-nzErrorTip="@@common.baseline-variation" nzErrorTip="Baseline">
          <nz-select
            class="nz-select-40"
            i18n-nzPlaceHolder="@@expt.overview.select-baseline-variation"
            nzPlaceHolder="Select baseline variation"
            formControlName="baselineVariationId">
            @for (o of currentVariations; track o) {
              <nz-option
                [nzValue]="o.id"
                [nzLabel]="o.value">
              </nz-option>
            }
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label i18n="@@common.default-confidence-level">Default Confidence Level</nz-form-label>
        <nz-form-control>
          <nz-select
            class="nz-select-40"
            i18n-nzPlaceHolder="@@expt.overview.select-default-confidence-level"
            nzPlaceHolder="Select default confidence level (e.g 95%)"
            formControlName="alpha">
            <nz-option nzValue="0.2" nzLabel="80%"/>
            <nz-option nzValue="0.1" nzLabel="90%"/>
            <nz-option nzValue="0.05" nzLabel="95%"/>
            <nz-option nzValue="0.02" nzLabel="98%"/>
            <nz-option nzValue="0.01" nzLabel="99%"/>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <button nz-button class="submit-btn" [nzType]="'primary'" [nzLoading]="isLoading" i18n="@@common.save">Save</button>
    </form>
  </ng-container>
  <ng-template #extra>
    <i (click)="onClose()" nz-icon nzType="icons:icon-close"></i>
  </ng-template>
</nz-drawer>

