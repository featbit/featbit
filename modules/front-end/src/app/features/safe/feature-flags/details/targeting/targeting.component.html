<section class="body-container">
  <div class="detail-body">
    <div class="banner">
      <div class="placeholder"></div>
      <div class="action-btns">
        <button nz-button nzType="primary" (click)="onSetExptRulesClick()" i18n="@@ff.components.details.targeting.setabtestrule">
          <i nz-icon nzType="filter" nzTheme="outline"></i>
          Set A/B test rule
        </button>
        <button nz-button nzType="primary" class="save-btn" (click)="onSave()" i18n="@@ff.components.details.targeting.save">
          <i nz-icon nzType="icons:icon-save"></i>
          Save & Update
        </button>
      </div>
    </div>
    <div class="content-container">
      <div class="standard-div" *ngIf="!isLoading; else loadingTem;">
        <div class="rule-banner">
          <div class="title" i18n="@@ff.components.details.targeting.defaultrule">Default rule</div>
          <i nz-tooltip="If the flag is turned on, the following variation is served" i18n-nz-tooltip="@@ff.components.details.targeting.defaultrule-tooltip"
             nz-icon nzType="icons:icon-info-outline"></i>
        </div>
        <div class="find-rule">
          <app-serve
            [variationOptions]="featureFlag.variations"
            [ruleVariations]="featureFlag.fallthrough.variations"
            (onPercentageChange)="onFallthroughChange($event)">
          </app-serve>
        </div>
      </div>
      <div class="standard-div target-users" *ngIf="!isLoading; else loadingTem;">
        <div class="rule-banner">
          <div class="title-wraper">
            <div class="title" i18n="@@ff.components.details.targeting.individualtargeting">Targeting users</div>
            <i *ngIf="isTargetUsersActive" nz-icon (click)="isTargetUsersActive = !isTargetUsersActive"
               nzType="icons:icon-arrow-down"></i>
            <i *ngIf="!isTargetUsersActive" nz-icon (click)="isTargetUsersActive = !isTargetUsersActive"
               nzType="icons:icon-arrow-right"></i>
          </div>
          <i nz-tooltip="The default rule will be overridden when the rules are met" i18n-nz-tooltip="@@ff.components.details.targeting.coverdefaultrule-tooltip"
             nz-icon nzType="icons:icon-info-outline"></i>
        </div>
        <div *ngIf="isTargetUsersActive" style="margin-left: -12px;margin-top: 16px">
          <div class="content" *ngFor="let variation of featureFlag.variations; let i = index">
            <target-user
              [type]="variation.value"
              [tipIdx]="i"
              [userList]="userList"
              [selectedUserDetailList]="targetingUsersByVariation[variation.id]"
              (search)="onSearchUser($event)"
              (onSelectedUserListChange)="onSelectedUserListChange($event, variation.id)">
            </target-user>
          </div>
        </div>
      </div>
      <div class="standard-div" *ngIf="!isLoading; else loadingTem;">
        <div class="rule-banner">
          <div class="title" i18n="@@common.rules">Rules</div>
          <i nz-tooltip="The default rule will be overridden when the rules are met" i18n-nz-tooltip="@@ff.components.details.targeting.coverdefaultrule-tooltip"
             nz-icon nzType="icons:icon-info-outline"></i>
          <i nz-icon (click)="onAddRule()" nzType="icons:icon-add-outline"></i>
        </div>
        <div class="drop-list" cdkDropList (cdkDropListDropped)="onDragEnd($event)">
          <ng-container *ngFor="let rule of featureFlag.rules; trackBy: trackRuleById;">
            <div class="drop-box rule" cdkDrag>
              <find-rule
                [data]="rule"
                [userProps]="userProps"
                (deleteRule)="onDeleteRule(rule.id)"
                (ruleConfigChange)="onRuleConditionChange($event, rule.id)"
                (updateRuleName)="rule.name = $event"
                (onPercentageChange)="onRuleVariationsChange($event, rule.id)">
              </find-rule>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
  <ng-template #loadingTem>
    <div class="block" style="margin: auto;text-align: center">
      <nz-skeleton [nzActive]="true" [nzParagraph]="{ rows: 4 }"></nz-skeleton>
    </div>
  </ng-template>
</section>

<!--<app-expt-rules-drawer [visible]="exptRulesVisible" (close)="onSetExptRulesClosed($event)"-->
<!--  [featureFlag]="featureFlag"></app-expt-rules-drawer>-->
