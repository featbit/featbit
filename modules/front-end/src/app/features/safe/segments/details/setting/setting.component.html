<section class="body-container">
  <ng-template #loadingTem>
    <div class="block">
      <nz-skeleton [nzActive]="true"></nz-skeleton>
    </div>
  </ng-template>

  <div class="block" *ngIf="!isLoading; else loadingTem;">
    <div class="title">
      <ng-container *ngIf="!isEditingTitle">
        <span [nz-tooltip]="segmentDetail?.name" class="text">{{segmentDetail?.name}}</span>
        <i class="edit-save" nz-tooltip="编辑用户组名称" (click)="toggleTitleEditState()" nz-icon nzType="icons:icon-edit"></i>
      </ng-container>
      <ng-container *ngIf="isEditingTitle">
        <input nz-input placeholder="名称..." [(ngModel)]="segmentDetail.name" />
        <i class="edit-save" (click)="saveTitle()" nz-icon nzType="icons:icon-save"></i>
      </ng-container>
    </div>
    <div class="description" [class]="{editing: isEditingDescription}">
      <ng-container *ngIf="!isEditingDescription">
        <span>{{segmentDetail?.description}}</span>
        <i class="edit-save" (click)="toggleDescriptionEditState()" nz-icon nzType="icons:icon-edit"></i>
      </ng-container>
      <ng-container *ngIf="isEditingDescription">
        <textarea nz-input placeholder="描述..." [(ngModel)]="segmentDetail.description" [nzAutosize]="{ minRows: 3 }"></textarea>
        <i class="edit-save" (click)="saveDescription()" nz-icon nzType="icons:icon-save"></i>
      </ng-container>
    </div>
  </div>
  <div class="block" style="margin-top: 20px" *ngIf="!isLoading; else loadingTem;">
    <div class="delete">
      <button nz-button nzType="default" (click)="openDeleteModal()">
        <i nz-icon nzType="icons:icon-delete"></i>
        删除用户组
      </button>
    </div>
  </div>
</section>

<nz-modal [(nzVisible)]="deleteModalVisible"
          [nzTitle]="deleteModalTitle"
          [nzCentered]="true"
          [nzContent]="deleteModalContent"
          [nzFooter]="deleteModalFooter"
          (nzOnCancel)="closeDeleteModal()">

  <ng-template #deleteModalTitle><span style="font-size:18px">删除用户组</span></ng-template>

  <ng-template #deleteModalContent>
    <div style="font-size:15px">用户组<span style="font-weight:800;display:inline-block;margin:0 3px;">{{segmentDetail.name}}</span>将被永久删除，且删除后不可恢复！</div>
    <div *ngIf="flagReferences.length > 0" class="warning-message">
      <div class="warning">
        <span class="warning-icon"><i nz-icon nzType="warning" nzTheme="fill"></i></span>
        <div class="warning-content">该用户组在下边列出的 <span style="font-weight:800;display:inline-block;margin:0 3px;">{{flagReferences.length}}</span> 个开关中被引用，移除所有引用后方可删除！</div>
      </div>
    </div>
    <div *ngFor="let flag of flagReferences" style="margin-top:5px">
      <div (click)="openFlagPage(flag.id)" style="cursor:pointer">{{flag.name}}</div>
    </div>
  </ng-template>

  <ng-template #deleteModalFooter>
    <button nz-button nzType="default" (click)="closeDeleteModal()">取消</button>
    <button nz-button nzType="primary" [nzLoading]="deleting" [disabled]="flagReferences.length > 0" (click)="delete()">删除</button>
  </ng-template>
</nz-modal>
