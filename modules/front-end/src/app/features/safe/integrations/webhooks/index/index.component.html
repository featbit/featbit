<div class="table-content-area">
  <div class="table-search-area">
    <div class="search-inputs">
      <nz-input-group [nzPrefix]="prefixIconSearch">
        <input nz-input type="text" placeholder="Filter by name" i18n-placeholder="@@common.searchNamePlaceholder">
      </nz-input-group>
      <ng-template #prefixIconSearch>
        <i nz-icon nzType="icons:icon-search"></i>
      </ng-template>
    </div>
    <button nz-button nzType="primary" (click)="openDrawer(undefined)">
      <i nz-icon nzType="icons:icon-add"></i>
      <ng-container i18n="@@common.add">Add</ng-container>
    </button>
  </div>

  <div class="table-wrapper">
    <nz-table #table nzSize="small"
              nzShowSizeChanger
              [nzData]="webhooks.items"
              [nzFrontPagination]="false"
              [nzLoading]="isLoading"
              [nzTotal]="webhooks.totalCount"
              [(nzPageSize)]="filter.pageSize"
              (nzPageSizeChange)="loadWebhooks()"
              [nzPageSizeOptions]="[10,20,30]"
              [(nzPageIndex)]="filter.pageIndex"
              (nzPageIndexChange)="loadWebhooks()"
    >
      <thead>
      <tr>
        <th i18n="@@common.name">Name</th>
        <th i18n="@@common.status">Status</th>
        <th i18n="@@integrations.webhooks.url">URL</th>
        <th i18n="@@common.scopes">Scopes</th>
        <th i18n="@@integrations.webhooks.events">Events</th>
        <th i18n="@@common.created-by">Created by</th>
        <th i18n="@@common.actions">Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let item of table.data">
        <td class="name" (click)="openDrawer(item)"> {{ item.name }} </td>
        <td class="status" nz-tooltip [nzTooltipTitle]="statusTooltip">
          <span [class]="item.isActive ? 'active' : 'inactive'">
            <i nz-icon [nzType]="item.isActive ? 'check-circle' : 'close-circle'"></i>
            <span *ngIf="item.isActive" i18n="@@common.active">Active</span>
            <span *ngIf="!item.isActive" i18n="@@common.inactive">Inactive</span>
          </span>
          <br>
          <ng-container *ngIf="item.lastDelivery">
            <i nz-icon
               [class]="item.lastDelivery.success ? 'success' : 'failed'"
               [nzType]="item.lastDelivery.success ? 'check-circle' : 'close-circle'">
            </i>
            <span>{{ item.lastDelivery.happenedAt | date: 'medium' }}</span>
          </ng-container>
          <span *ngIf="!item.lastDelivery" class="never" i18n="@@integrations.webhooks.never-triggered">Never Triggered</span>
          <ng-template #statusTooltip>
            <span *ngIf="item.isActive" i18n="@@integrations.webhooks.status-active-tooltip">This hook is active.</span>
            <span *ngIf="!item.isActive"
                  i18n="@@integrations.webhooks.status-inactive-tooltip">This hook is inactive.</span>
            <span *ngIf="item.lastDelivery">
              <br>
              {{ getDeliveryTooltip(item.lastDelivery) }}
            </span>
          </ng-template>
        </td>
        <td class="url">
          <span nz-tooltip [nzTooltipTitle]="item.url">{{ item.url }}</span>
        </td>
        <td class="scopes">
          <span nz-tooltip [nzTooltipTitle]="scopesTooltip">{{ item.scopes }}</span>
          <ng-template #scopesTooltip>
            <ul>
              <li *ngFor="let scope of item.scopes;">{{ scope }}</li>
            </ul>
          </ng-template>
        </td>
        <td class="events">
          <span nz-tooltip [nzTooltipTitle]="eventsTooltip">{{ item.events }}</span>
          <ng-template #eventsTooltip>
            <ul>
              <li *ngFor="let event of item.events;">{{ event }}</li>
            </ul>
          </ng-template>
        </td>
        <td> {{ item.creator.name ?? item.creator.email }} </td>
        <td class="actions">
          <button nz-button nzType="link" (click)="openDrawer(item)">
            <i nz-icon nzType="icons:icon-edit"></i>
            <span i18n="@@common.edit">Edit</span>
          </button>
          <button
            nz-button
            nzType="link"
            nz-popconfirm
            nzPopconfirmTitle="Are you sure to remove it?"
            i18n-nzPopconfirmTitle="@@common.simple-remove-confirm"
            nzPopconfirmPlacement="top"
            (nzOnConfirm)="remove(item.id)">
            <i nz-icon nzType="icons:icon-delete"></i>
            <span i18n="@@common.remove">Remove</span>
          </button>
        </td>
      </tr>
      </tbody>
    </nz-table>
  </div>
</div>

<webhook-drawer [webhook]="selectedWebhook" [visible]="drawerVisible" (close)="closeDrawer($event)"></webhook-drawer>
