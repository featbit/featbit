<div class="table-content-area">
  <div class="table-search-area">
    <nz-input-group [nzPrefix]="prefixIconSearch">
      <input nz-input type="text" placeholder="Filter by name" [(ngModel)]="filter.name" (ngModelChange)="doSearch(true)" i18n-placeholder="@@integrations.access-tokens.searchNamePlaceholder">
    </nz-input-group>
    <ng-template #prefixIconSearch>
      <i nz-icon nzType="icons:icon-search"></i>
    </ng-template>
    <nz-select
      i18n-nzPlaceHolder="@@integrations.access-tokens.filter-by-creator"
      nzPlaceHolder="Select creator"
      nzAllowClear
      nzShowSearch
      nzServerSearch
      (ngModelChange)="doSearch(true)"
      [(ngModel)]="filter.creatorId"
      (nzOnSearch)="onSearchCreators($event)">
      <ng-container *ngFor="let o of creatorList">
        <nz-option
          *ngIf="!isCreatorsLoading"
          [nzValue]="o.id"
          [nzLabel]="o.name || o.email">
        </nz-option>
      </ng-container>
      <nz-option *ngIf="isCreatorsLoading" nzDisabled nzCustomContent>
        <i nz-icon nzType="loading" class="loading-icon"></i>
        <ng-container i18n="@@common.loading">Loading...</ng-container>
      </nz-option>
    </nz-select>
    <nz-select nzAllowClear [(ngModel)]="filter.type" (ngModelChange)="doSearch(true)" i18n-nzPlaceHolder="@@integrations.access-tokens.filter-by-type" nzPlaceHolder="Filter by type">
      <nz-option [nzValue]="AccessTokenStatusActive" [nzLabel]="AccessTokenStatusActive | accessTokenStatus"></nz-option>
      <nz-option [nzValue]="AccessTokenStatusInactive" [nzLabel]="AccessTokenStatusInactive | accessTokenStatus"></nz-option>
    </nz-select>
    <button nz-button nzType="primary" (click)="openAccessTokenDrawer()">
      <i nz-icon nzType="icons:icon-add"></i>
      <ng-container i18n="@@common.add">Add</ng-container>
    </button>
  </div>
  <div class="table-wrapper">
    <nz-table #table nzSize="small"
              nzShowSizeChanger
              [nzData]="accessTokens.items"
              [nzFrontPagination]="false"
              [nzLoading]="isLoading"
              [nzTotal]="accessTokens.totalCount"
              [(nzPageSize)]="filter.pageSize"
              (nzPageSizeChange)="doSearch()"
              [nzPageSizeOptions]="[10,20,30]"
              [(nzPageIndex)]="filter.pageIndex"
              (nzPageIndexChange)="doSearch()"
              >
      <thead>
      <tr>
        <th nzWidth="20%" i18n="@@common.name">Name</th>
        <th nzWidth="10%" i18n="@@common.type">Type</th>
        <th nzWidth="15%" i18n="@@common.creator">Creator</th>
        <th nzWidth="10%" i18n="@@common.status">Status</th>
        <th nzWidth="20%" i18n="@@common.last-used">Last used</th>
        <th i18n="@@common.actions">Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let item of table.data">
        <td>{{ item.name }}</td>
        <td>
          {{item.type | accessTokenType}}
        </td>
        <td>
          <ng-container *ngIf="item.creator.name">{{ item.creator.name }} ({{ item.creator.email }})</ng-container>
          <ng-container *ngIf="!item.creator.name">{{ item.creator.email }}</ng-container>
        </td>
        <td>{{ item.status | accessTokenStatus }}</td>
        <td>{{ item.lastUsedAt | date: 'YYYY-MM-dd HH:mm'}}</td>
        <td>
          <a class="primary-link-btn" i18n="@@common.edit">Edit</a>

          <ng-container *ngIf="item.status === AccessTokenStatusInactive">
            <nz-divider nzType="vertical"></nz-divider>
            <a class="primary-link-btn" i18n="@@common.activate">Activate</a>
          </ng-container>

          <ng-container *ngIf="item.status === AccessTokenStatusActive">
            <nz-divider nzType="vertical"></nz-divider>
            <a style="color: #717D8A" i18n="@@common.Deactivate">Deactivate</a>
          </ng-container>

          <nz-divider nzType="vertical"></nz-divider>
          <a style="color: #717D8A" i18n-nz-popconfirm="@@common.remove-confirm"  nz-popconfirm="This operation cannot be reverted, are you sure to remove it?"
             nzPopconfirmPlacement="bottomRight"
             [nzPopconfirmOverlayStyle]="{minWidth: '240px'}"
             (nzOnConfirm)="delete(item)" [nzIcon]="iconTplIamUser">
            <ng-container i18n="@@common.remove">Remove</ng-container>
          </a>
        </td>
      </tr>
      </tbody>
    </nz-table>
    <ng-template #iconTplIamUser>
      <i nz-icon nzType="question-circle" nzTheme="fill" style="color: #FAAD14;"></i>
    </ng-template>
  </div>
</div>

<access-token-drawer [visible]="accessTokenDrawerVisible" (close)="policyDrawerClosed($event)"></access-token-drawer>

